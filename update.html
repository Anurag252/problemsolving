	<p>#!/bin/sh
#
	<ol>
		<li>An example hook script to block unannotated tags from entering.</li>
		<li>Called by &#8220;git receive-pack&#8221; with arguments: refname sha1-old sha1-new</li>
	</ol>
#
	<ol>
		<li>To enable this hook, rename this file to &#8220;update&#8221;.</li>
	</ol>
#
	<ol>
		<li>Config</li>
		<li>&#8212;&#8212;&#8212;</li>
		<li>hooks.allowunannotated</li>
		<li>This boolean sets whether unannotated tags will be allowed into the</li>
		<li>repository.  By default they won&#8217;t be.</li>
		<li>hooks.allowdeletetag</li>
		<li>This boolean sets whether deleting tags will be allowed in the</li>
		<li>repository.  By default they won&#8217;t be.</li>
		<li>hooks.allowmodifytag</li>
		<li>This boolean sets whether a tag may be modified after creation. By default</li>
		<li>it won&#8217;t be.</li>
		<li>hooks.allowdeletebranch</li>
		<li>This boolean sets whether deleting branches will be allowed in the</li>
		<li>repository.  By default they won&#8217;t be.</li>
		<li>hooks.denycreatebranch</li>
		<li>This boolean sets whether remotely creating branches will be denied</li>
		<li>in the repository.  By default this is allowed.</li>
	</ol>
#</p>

	<ol>
		<li>&#8212;- Command line<br />
refname=&#8221;$1&#8221;<br />
oldrev=&#8221;$2&#8221;<br />
newrev=&#8221;$3&#8221;</li>
	</ol>

	<ol>
		<li>&#8212;- Safety check<br />
if [ -z &#8220;$GIT_DIR&#8221; ]; then
	echo &#8220;Don&#8217;t run this script from the command line.&#8221; >&2
	echo &#8220; (if you want, you could supply GIT_DIR then run&#8221; >&2
	echo &#8220;  $0 <ref> <oldrev> <newrev>)&#8221; >&2
	exit 1<br />
fi</li>
	</ol>

	<p>if [ -z &#8220;$refname&#8221; -o -z &#8220;$oldrev&#8221; -o -z &#8220;$newrev&#8221; ]; then
	echo &#8220;usage: $0 <ref> <oldrev> <newrev>&#8221; >&2
	exit 1<br />
fi</p>

	<ol>
		<li>&#8212;- Config<br />
allowunannotated=$(git config &#8212;type=bool hooks.allowunannotated)<br />
allowdeletebranch=$(git config &#8212;type=bool hooks.allowdeletebranch)<br />
denycreatebranch=$(git config &#8212;type=bool hooks.denycreatebranch)<br />
allowdeletetag=$(git config &#8212;type=bool hooks.allowdeletetag)<br />
allowmodifytag=$(git config &#8212;type=bool hooks.allowmodifytag)</li>
	</ol>

	<ol>
		<li>check for no description<br />
projectdesc=$(sed -e &#8216;1q&#8217; &#8220;$GIT_DIR/description&#8221;)<br />
case &#8220;$projectdesc&#8221; in<br />
&#8220;Unnamed repository&#8221;* | &#8220;&#8221;)
	echo &#8220;*** Project description file hasn&#8217;t been set&#8221; >&2
	exit 1
	;;<br />
esac</li>
	</ol>

	<ol>
		<li>&#8212;- Check types</li>
		<li>if $newrev is 0000&#8230;0000, it&#8217;s a commit to delete a ref.<br />
zero=$(git hash-object &#8212;stdin </dev/null | tr '[0-9a-f]' '0')<br />
if [ &#8220;$newrev&#8221; = &#8220;$zero&#8221; ]; then
	newrev_type=delete<br />
else
	newrev_type=$(git cat-file -t $newrev)<br />
fi</li>
	</ol>

	<p>case &#8220;$refname&#8221;,&#8221;$newrev_type&#8221; in
	refs/tags/*,commit)
		# un-annotated tag
		short_refname=${refname##refs/tags/}
		if [ &#8220;$allowunannotated&#8221; != &#8220;true&#8221; ]; then
			echo &#8220;*** The un-annotated tag, $short_refname, is not allowed in this repository&#8221; >&2
			echo &#8220;*** Use &#8216;git tag [ -a | -s ]&#8217; for tags you want to propagate.&#8221; >&2
			exit 1
		fi
		;;
	refs/tags/*,delete)
		# delete tag
		if [ &#8220;$allowdeletetag&#8221; != &#8220;true&#8221; ]; then
			echo &#8220;*** Deleting a tag is not allowed in this repository&#8221; >&2
			exit 1
		fi
		;;
	refs/tags/*,tag)
		# annotated tag
		if [ &#8220;$allowmodifytag&#8221; != &#8220;true&#8221; ] &&amp; git rev-parse $refname > /dev/null 2>&1
		then
			echo &#8220;*** Tag &#8216;$refname&#8217; already exists.&#8221; >&2
			echo &#8220;*** Modifying a tag is not allowed in this repository.&#8221; >&2
			exit 1
		fi
		;;
	refs/heads/*,commit)
		# branch
		if [ &#8220;$oldrev&#8221; = &#8220;$zero&#8221; -a &#8220;$denycreatebranch&#8221; = &#8220;true&#8221; ]; then
			echo &#8220;*** Creating a branch is not allowed in this repository&#8221; >&2
			exit 1
		fi
		;;
	refs/heads/*,delete)
		# delete branch
		if [ &#8220;$allowdeletebranch&#8221; != &#8220;true&#8221; ]; then
			echo &#8220;*** Deleting a branch is not allowed in this repository&#8221; >&2
			exit 1
		fi
		;;
	refs/remotes/*,commit)
		# tracking branch
		;;
	refs/remotes/*,delete)
		# delete tracking branch
		if [ &#8220;$allowdeletebranch&#8221; != &#8220;true&#8221; ]; then
			echo &#8220;*** Deleting a tracking branch is not allowed in this repository&#8221; >&2
			exit 1
		fi
		;;
	*)
		# Anything else (is there anything else?)
		echo &#8220;*** Update hook: unknown type of update to ref $refname of type $newrev_type&#8221; >&2
		exit 1
		;;<br />
esac</p>

	<ol>
		<li>&#8212;- Finished<br />
exit 0</li>
	</ol>