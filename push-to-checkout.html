	<p>#!/bin/sh</p>

	<ol>
		<li>An example hook script to update a checked-out tree on a git push.</li>
	</ol>
#
	<ol>
		<li>This hook is invoked by git-receive-pack(1) when it reacts to git</li>
		<li>push and updates reference(s) in its repository, and when the push</li>
		<li>tries to update the branch that is currently checked out and the</li>
		<li>receive.denyCurrentBranch configuration variable is set to</li>
		<li>updateInstead.</li>
	</ol>
#
	<ol>
		<li>By default, such a push is refused if the working tree and the index</li>
		<li>of the remote repository has any difference from the currently</li>
		<li>checked out commit; when both the working tree and the index match</li>
		<li>the current commit, they are updated to match the newly pushed tip</li>
		<li>of the branch. This hook is to be used to override the default</li>
		<li>behaviour; however the code below reimplements the default behaviour</li>
		<li>as a starting point for convenient modification.</li>
	</ol>
#
	<ol>
		<li>The hook receives the commit with which the tip of the current</li>
		<li>branch is going to be updated:<br />
commit=$1</li>
	</ol>

	<ol>
		<li>It can exit with a non-zero status to refuse the push (when it does</li>
		<li>so, it must not modify the index or the working tree).<br />
die () {
	echo >&2 &#8220;$*&#8220;
	exit 1<br />
}</li>
	</ol>

	<ol>
		<li>Or it can make any necessary changes to the working tree and to the</li>
		<li>index to bring them to the desired state when the tip of the current</li>
		<li>branch is updated to the new commit, and exit with a zero status.</li>
	</ol>
#
	<ol>
		<li>For example, the hook can simply run git read-tree -u -m <span class="caps">HEAD</span> &#8220;$1&#8221;</li>
		<li>in order to emulate git fetch that is run in the reverse direction</li>
		<li>with git push, as the two-tree form of git read-tree -u -m is</li>
		<li>essentially the same as git switch or git checkout that switches</li>
		<li>branches while keeping the local changes in the working tree that do</li>
		<li>not interfere with the difference between the branches.</li>
	</ol>

	<ol>
		<li>The below is a more-or-less exact translation to shell of the C code</li>
		<li>for the default behaviour for git&#8217;s push-to-checkout hook defined in</li>
		<li>the push_to_deploy() function in builtin/receive-pack.c.</li>
	</ol>
#
	<ol>
		<li>Note that the hook will be executed from the repository directory,</li>
		<li>not from the working tree, so if you want to perform operations on</li>
		<li>the working tree, you will have to adapt your code accordingly, e.g.</li>
		<li>by adding &#8220;cd ..&#8221; or using relative paths.</li>
	</ol>

	<p>if ! git update-index -q &#8212;ignore-submodules &#8212;refresh<br />
then
	die &#8220;Up-to-date check failed&#8220;<br />
fi</p>

	<p>if ! git diff-files &#8212;quiet &#8212;ignore-submodules &#8212;<br />
then
	die &#8220;Working directory has unstaged changes&#8220;<br />
fi</p>

	<ol>
		<li>This is a rough translation of:</li>
	</ol>
#
	<ol>
		<li>head_has_history() ? &#8220;<span class="caps">HEAD</span>&#8221; : <span class="caps">EMPTY</span>_TREE_SHA1_HEX<br />
if git cat-file -e HEAD 2>/dev/null<br />
then
	head=HEAD<br />
else
	head=$(git hash-object -t tree &#8212;stdin </dev/null)<br />
fi</li>
	</ol>

	<p>if ! git diff-index &#8212;quiet &#8212;cached &#8212;ignore-submodules $head &#8212;<br />
then
	die &#8220;Working directory has staged changes&#8220;<br />
fi</p>

	<p>if ! git read-tree -u -m &#8220;$commit&#8220;<br />
then
	die &#8220;Could not update working tree to new <span class="caps">HEAD</span>&#8220;<br />
fi</p>